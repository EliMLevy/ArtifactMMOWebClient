import{m as $,b as F,u as I,c as j,d as M,f as U,e as z,g as k,h as O,i as W,j as P,V as p,k as q,a as C,l as H,_ as Q,n as G}from"./AddActionsForm.vue_vue_type_script_setup_true_lang-y-yD3op1.js";import{p as J,g as K,u as X,e as N,f as Y,I as Z,h as R,i as ee,m as D,a as t,j as ae,n as te,d as re,k as le,o as y,c as E,w as l,l as s,t as i,q as r,s as c,v as B,x as L,y as S,z as ne,F as oe,A as se}from"./index-qrAWiDEK.js";const ie=J({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...$({origin:"center center",scrollStrategy:"block",transition:{component:F},zIndex:2400})},"VDialog"),ce=K()({name:"VDialog",props:ie(),emits:{"update:modelValue":n=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(n,f){let{emit:d,slots:u}=f;const g=X(n,"modelValue"),{scopeId:x}=I(),a=N();function V(e){var h,b;const m=e.relatedTarget,o=e.target;if(m!==o&&((h=a.value)!=null&&h.contentEl)&&((b=a.value)!=null&&b.globalTop)&&![document,a.value.contentEl].includes(o)&&!a.value.contentEl.contains(o)){const v=ae(a.value.contentEl);if(!v.length)return;const w=v[0],T=v[v.length-1];m===w?T.focus():w.focus()}}Y(()=>{document.removeEventListener("focusin",V)}),Z&&R(()=>g.value&&n.retainFocus,e=>{e?document.addEventListener("focusin",V):document.removeEventListener("focusin",V)},{immediate:!0});function A(){var e;d("afterEnter"),(e=a.value)!=null&&e.contentEl&&!a.value.contentEl.contains(document.activeElement)&&a.value.contentEl.focus({preventScroll:!0})}function _(){d("afterLeave")}return R(g,async e=>{var m;e||(await te(),(m=a.value.activatorEl)==null||m.focus({preventScroll:!0}))}),ee(()=>{const e=j.filterProps(n),m=D({"aria-haspopup":"dialog"},n.activatorProps),o=D({tabindex:-1},n.contentProps);return t(j,D({ref:a,class:["v-dialog",{"v-dialog--fullscreen":n.fullscreen,"v-dialog--scrollable":n.scrollable},n.class],style:n.style},e,{modelValue:g.value,"onUpdate:modelValue":h=>g.value=h,"aria-modal":"true",activatorProps:m,contentProps:o,height:n.fullscreen?void 0:n.height,width:n.fullscreen?void 0:n.width,maxHeight:n.fullscreen?void 0:n.maxHeight,maxWidth:n.fullscreen?void 0:n.maxWidth,role:"dialog",onAfterEnter:A,onAfterLeave:_},x),{activator:u.activator,default:function(){for(var h=arguments.length,b=new Array(h),v=0;v<h;v++)b[v]=arguments[v];return t(M,{root:"VDialog"},{default:()=>{var w;return[(w=u.default)==null?void 0:w.call(u,...b)]}})}})}),U({},a)}}),de={class:"d-flex justify-center",style:{border:"1px solid white",borderRadius:"3px",position:"relative",overflow:"hidden",height:"10px"}},ue={class:"d-flex justify-center",style:{border:"1px solid white",borderRadius:"3px",position:"relative",overflow:"hidden",height:"10px"}},me={key:0},fe={class:"d-flex justify-center",style:{border:"1px solid white",borderRadius:"3px",position:"relative",overflow:"hidden",height:"10px"}},pe={class:"d-flex align-center justify-space-between"},he={class:"d-flex align-center"},ye=re({__name:"CharacterCard",props:{characterName:{type:String,required:!0}},setup(n){const f=n,d=z();d.fetchCharacter(f.characterName);const u=N(void 0),g=N(!1),x=N(!1),a=le(()=>d.characters[f.characterName]);R(()=>d.characters[f.characterName].defaultState,_=>{u.value=_.state});const V=[{name:"idle",parameters:["repeat"]},{name:"move",parameters:["x","y","repeat"]},{name:"attack",parameters:["repeat"]},{name:"rest",parameters:["repeat"]},{name:"collect",parameters:["repeat"]},{name:"craft",parameters:["code","quantity","repeat"]},{name:"recycle",parameters:["code","quantity","repeat"]},{name:"use item",parameters:["code","quantity","repeat"]},{name:"equip",parameters:["code","slot","repeat"]},{name:"deposit all",parameters:["repeat"]},{name:"withdraw",parameters:["code","quantity","repeat"]},{name:"autopilot",parameters:["repeat"]},{name:"copy queue",parameters:["repeat"]},{name:"paste queue",parameters:["repeat"]}];async function A(){u.value&&(x.value=!0,d.setDefaultAction(f.characterName,u.value),g.value=!1,x.value=!1)}return(_,e)=>(y(),E(G,null,{default:l(()=>[t(O,{class:"d-flex justify-space-between"},{default:l(()=>[s(i(f.characterName)+" ",1),t(k,{icon:"mdi-refresh",color:"primary",variant:"outlined",density:"compact",loading:r(d).loading[f.characterName],onClick:e[0]||(e[0]=m=>r(d).fetchCharacter(f.characterName))},null,8,["loading"])]),_:1}),r(d).loading[f.characterName]?S("",!0):(y(),E(W,{key:0},{default:l(()=>{var m;return[t(P,{class:"my-2"}),t(C,null,{default:l(()=>[t(p,null,{default:l(()=>[t(q,null,{default:l(()=>e[4]||(e[4]=[s("mdi-arrow-up-bold")])),_:1}),s(" "+i(r(a).character.data.level)+" ",1),c("div",de,[c("div",{style:B({position:"absolute",left:"0",right:"0",height:"100%",width:`${r(a).character.data.xp/r(a).character.data.max_xp*100}%`,backgroundColor:"lightgreen"})},null,4)])]),_:1}),t(p,null,{default:l(()=>[t(q,null,{default:l(()=>e[5]||(e[5]=[s("mdi-heart")])),_:1}),s(" "+i(r(a).character.data.hp)+"/"+i(r(a).character.data.max_hp)+" ",1),c("div",ue,[c("div",{style:B({position:"absolute",left:"0",right:"0",height:"100%",width:`${r(a).character.data.hp/r(a).character.data.max_hp*100}%`,backgroundColor:"red"})},null,4)])]),_:1}),t(p,null,{default:l(()=>[t(q,null,{default:l(()=>e[6]||(e[6]=[s("mdi-map-marker")])),_:1}),s(" "+i(r(a).currentMap.data.name)+" ",1),r(a).currentMap.data.content?(y(),L("span",me," -"+i(r(a).currentMap.data.content.code),1)):S("",!0)]),_:1})]),_:1}),r(a).character.data.task?(y(),E(C,{key:0},{default:l(()=>[t(p,null,{default:l(()=>[s(i(r(a).character.data.task),1)]),_:1}),t(p,null,{default:l(()=>[c("div",fe,[c("div",{style:B({position:"absolute",left:"0",right:"0",height:"100%",width:`${r(a).character.data.task_progress/r(a).character.data.task_total*100}%`,backgroundColor:"lightgreen"})},null,4)])]),_:1}),t(p,null,{default:l(()=>[s(i(r(a).character.data.task_progress)+"/"+i(r(a).character.data.task_total),1)]),_:1})]),_:1})):S("",!0),t(P,{class:"my-2"}),c("div",null,[e[7]||(e[7]=c("span",{class:"font-weight-bold"},"Last action: ",-1)),s(" "+i((m=r(a).lastState)==null?void 0:m.state),1)]),c("div",null,[c("div",pe,[e[8]||(e[8]=c("div",{class:"font-weight-bold"},"Upcoming:",-1)),t(k,{icon:"mdi-delete",color:"red",rounded:"sm",density:"compact",onClick:e[1]||(e[1]=o=>r(d).clearCharacterQueue(n.characterName))})]),(y(!0),L(oe,null,ne(r(a).upcomingActions,(o,h)=>(y(),L("div",{class:"pl-5",key:h},[t(C,null,{default:l(()=>[t(p,null,{default:l(()=>[s(i(o.state),1)]),_:2},1024),t(p,null,{default:l(()=>[s(i(o.x||o.code||o.repeat),1)]),_:2},1024),t(p,null,{default:l(()=>[s(i(o.y||o.quantity),1)]),_:2},1024)]),_:2},1024)]))),128))]),t(P,{class:"my-3"}),c("div",he,[e[9]||(e[9]=c("div",{class:"font-weight-bold mr-1"},"Default action:",-1)),t(H,{items:V.map(o=>o.name),"onUpdate:modelValue":[e[2]||(e[2]=o=>g.value=!0),e[3]||(e[3]=o=>se(u)?u.value=o:null)],modelValue:r(u),"hide-details":"",variant:"outlined",density:"compact"},null,8,["items","modelValue"]),r(g)?(y(),E(k,{key:0,class:"ml-2",icon:"mdi-check",rounded:"sm",density:"compact",color:"light-green",onClick:A,loading:r(x)},null,8,["loading"])):S("",!0)]),t(C,{class:"mt-2"},{default:l(()=>[t(p,null,{default:l(()=>[t(ce,{"max-width":"500"},{activator:l(({props:o})=>[t(k,D({class:"w-100",color:"primary"},o),{default:l(()=>e[10]||(e[10]=[s(" Add Actions ")])),_:2},1040)]),default:l(({isActive:o})=>[t(Q,{close:()=>o.value=!1,"character-name":n.characterName},null,8,["close","character-name"])]),_:1})]),_:1})]),_:1})]}),_:1}))]),_:1}))}});export{ye as _};
